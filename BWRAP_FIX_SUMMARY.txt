╔══════════════════════════════════════════════════════════════════════╗
║                                                                      ║
║         🔧  CORREÇÃO: CONFLITO UMU + BWRAP  🔧                       ║
║                                                                      ║
╚══════════════════════════════════════════════════════════════════════╝

Data: 06 de Outubro de 2025
Status: ✅ CORRIGIDO

═══════════════════════════════════════════════════════════════════════

❌ PROBLEMA
═══════════════════════════════════════════════════════════════════════

Erro ao usar UMU + bwrap juntos:

  pressure-vessel-wrap[32913]: E: Processo filho concluído com código 1:
  bwrap: Unexpected capabilities but not setuid, old file caps config?

Jogos não abriam quando:
  ✓ UMU estava habilitado
  ✓ bwrap estava habilitado
  ✗ Conflito de containerização!

═══════════════════════════════════════════════════════════════════════

🔍 CAUSA
═══════════════════════════════════════════════════════════════════════

UMU já usa pressure-vessel (baseado em bwrap) internamente.

Linux-Coop tentava adicionar OUTRA camada de bwrap:

  ┌───────────────────────────┐
  │ Linux-Coop bwrap          │  ← Camada 1
  │ ┌─────────────────────┐   │
  │ │ UMU pressure-vessel │   │  ← Camada 2 (CONFLITO!)
  │ │ ┌─────────────────┐ │   │
  │ │ │ Jogo            │ │   │
  │ │ └─────────────────┘ │   │
  │ └─────────────────────┘   │
  └───────────────────────────┘

Resultado: Container dentro de container = ERRO

═══════════════════════════════════════════════════════════════════════

✅ SOLUÇÃO
═══════════════════════════════════════════════════════════════════════

bwrap é AUTOMATICAMENTE DESABILITADO quando UMU está ativo.

Código adicionado em src/services/instance.py:

  if profile.use_umu:
      # UMU já fornece containerização via pressure-vessel
      if self._use_bwrap:
          self.logger.warning("Desabilitando bwrap automaticamente")
          self._use_bwrap = False

═══════════════════════════════════════════════════════════════════════

📊 COMPORTAMENTO
═══════════════════════════════════════════════════════════════════════

MODO TRADICIONAL (sem UMU):
  ✅ bwrap pode ser usado
  ✅ Isola dispositivos normalmente
  ✅ Funciona como antes

MODO UMU:
  ✅ bwrap automaticamente desabilitado
  ✅ UMU pressure-vessel assume
  ✅ SEM conflito de capabilities
  ✅ Jogos abrem normalmente!

═══════════════════════════════════════════════════════════════════════

📝 LOGS ESPERADOS
═══════════════════════════════════════════════════════════════════════

Ao iniciar jogo com UMU, você verá:

  INFO: Using UMU launcher for 'Borderlands 3'
  WARNING: UMU mode detected: Automatically disabling bwrap
  WARNING: UMU already provides containerization via pressure-vessel
  INFO: Launching 2 instance(s) of 'Borderlands 3'...

Isso é NORMAL e ESPERADO!

═══════════════════════════════════════════════════════════════════════

💡 IMPORTANTE
═══════════════════════════════════════════════════════════════════════

Você NÃO perde funcionalidade!

  ✅ Isolação de dispositivos: Fornecida pelo UMU pressure-vessel
  ✅ Containerização: Fornecida pelo UMU pressure-vessel
  ✅ Segurança: Mantida pelo UMU
  
Apenas evitamos DUPLICAÇÃO de containerização que causava erro.

═══════════════════════════════════════════════════════════════════════

✅ VALIDAÇÃO
═══════════════════════════════════════════════════════════════════════

  ✅ Código compilado sem erros
  ✅ Lógica de detecção implementada
  ✅ Logs informativos adicionados
  ✅ Compatibilidade mantida

═══════════════════════════════════════════════════════════════════════

🎯 RESULTADO
═══════════════════════════════════════════════════════════════════════

Agora você pode usar UMU normalmente!

  ✅ Sem erros de bwrap capabilities
  ✅ Jogos abrem corretamente
  ✅ UMU funciona como esperado
  ✅ Containerização automática

═══════════════════════════════════════════════════════════════════════

🎉 PROBLEMA RESOLVIDO! 🎉

═══════════════════════════════════════════════════════════════════════
